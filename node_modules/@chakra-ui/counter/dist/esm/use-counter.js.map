{"version":3,"sources":["../../src/use-counter.ts"],"names":["useControllableProp","countDecimalPlaces","clampValue","maxSafeInteger","minSafeInteger","toPrecision","useCallback","useState","useCounter","props","onChange","precision","precisionProp","defaultValue","value","valueProp","step","stepProp","min","max","keepWithinRange","valueState","setValue","cast","isControlled","decimalPlaces","getDecimalPlaces","parse","update","next","toString","clamp","nextValue","increment","decrement","reset","castValue","valueAsNumber","isOutOfRange","isAtMax","isAtMin","parseFloat","replace","Math"],"mappings":"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","sourcesContent":["import { useControllableProp } from \"@chakra-ui/hooks\"\nimport {\n  countDecimalPlaces,\n  clampValue,\n  maxSafeInteger,\n  minSafeInteger,\n  toPrecision,\n  StringOrNumber,\n} from \"@chakra-ui/utils\"\nimport { useCallback, useState } from \"react\"\n\nexport interface UseCounterProps {\n  /**\n   * The callback fired when the value changes\n   */\n  onChange?(valueAsString: string, valueAsNumber: number): void\n  /**\n   * The number of decimal points used to round the value\n   */\n  precision?: number\n  /**\n   * The initial value of the counter. Should be less than `max` and greater than `min`\n   */\n  defaultValue?: StringOrNumber\n  /**\n   * The value of the counter. Should be less than `max` and greater than `min`\n   */\n  value?: StringOrNumber\n  /**\n   * The step used to increment or decrement the value\n   * @default 1\n   */\n  step?: number\n  /**\n   * The minimum value of the counter\n   * @default -Infinity\n   */\n  min?: number\n  /**\n   * The maximum value of the counter\n   * @default Infinity\n   */\n  max?: number\n  /**\n   * This controls the value update behavior in general.\n   *\n   * - If `true` and you use the stepper or up/down arrow keys,\n   *  the value will not exceed the `max` or go lower than `min`\n   *\n   * - If `false`, the value will be allowed to go out of range.\n   *\n   * @default true\n   */\n  keepWithinRange?: boolean\n}\n\nexport function useCounter(props: UseCounterProps = {}) {\n  const {\n    onChange,\n    precision: precisionProp,\n    defaultValue,\n    value: valueProp,\n    step: stepProp = 1,\n    min = minSafeInteger,\n    max = maxSafeInteger,\n    keepWithinRange = true,\n  } = props\n\n  const [valueState, setValue] = useState<StringOrNumber>(() => {\n    if (defaultValue == null) return \"\"\n    return cast(defaultValue, stepProp, precisionProp)\n  })\n\n  /**\n   * Because the component that consumes this hook can be controlled or uncontrolled\n   * we'll keep track of that\n   */\n  const [isControlled, value] = useControllableProp(valueProp, valueState)\n\n  const decimalPlaces = getDecimalPlaces(parse(value), stepProp)\n\n  const precision = precisionProp ?? decimalPlaces\n\n  const update = useCallback(\n    (next: StringOrNumber) => {\n      if (!isControlled) {\n        setValue(next.toString())\n      }\n      onChange?.(next.toString(), parse(next))\n    },\n    [onChange, isControlled],\n  )\n\n  // Function to clamp the value and round it to the precision\n  const clamp = useCallback(\n    (value: number) => {\n      let nextValue = value\n\n      if (keepWithinRange) {\n        nextValue = clampValue(nextValue, min, max)\n      }\n\n      return toPrecision(nextValue, precision)\n    },\n    [precision, keepWithinRange, max, min],\n  )\n\n  const increment = useCallback(\n    (step = stepProp) => {\n      let next: StringOrNumber\n\n      /**\n       * Let's follow the native browser behavior for\n       * scenarios where the input starts empty (\"\")\n       */\n      if (value === \"\") {\n        /**\n         * If `min` is set, native input, starts at the `min`.\n         * Else, it starts at `step`\n         */\n        next = parse(step)\n      } else {\n        next = parse(value) + step\n      }\n\n      next = clamp(next as number)\n      update(next)\n    },\n    [clamp, stepProp, update, value],\n  )\n\n  const decrement = useCallback(\n    (step = stepProp) => {\n      let next: StringOrNumber\n\n      // Same thing here. We'll follow native implementation\n      if (value === \"\") {\n        next = parse(-step)\n      } else {\n        next = parse(value) - step\n      }\n\n      next = clamp(next as number)\n      update(next)\n    },\n    [clamp, stepProp, update, value],\n  )\n\n  const reset = useCallback(() => {\n    let next: StringOrNumber\n    if (defaultValue == null) {\n      next = \"\"\n    } else {\n      next = cast(defaultValue, stepProp, precisionProp)\n    }\n    update(next)\n  }, [defaultValue, precisionProp, stepProp, update])\n\n  const castValue = useCallback(\n    (value: StringOrNumber) => {\n      update(cast(value, stepProp, precision))\n    },\n    [precision, stepProp, update],\n  )\n\n  const valueAsNumber = parse(value)\n\n  /**\n   * Common range checks\n   */\n  const isOutOfRange = valueAsNumber > max || valueAsNumber < min\n  const isAtMax = valueAsNumber === max\n  const isAtMin = valueAsNumber === min\n\n  return {\n    isOutOfRange,\n    isAtMax,\n    isAtMin,\n    precision,\n    value,\n    valueAsNumber,\n    update,\n    reset,\n    increment,\n    decrement,\n    clamp,\n    cast: castValue,\n  }\n}\n\nexport type UseCounterReturn = ReturnType<typeof useCounter>\n\nfunction parse(value: StringOrNumber) {\n  return parseFloat(value.toString().replace(/[^\\w.-]+/g, \"\"))\n}\n\nfunction getDecimalPlaces(value: number, step: number) {\n  return Math.max(countDecimalPlaces(step), countDecimalPlaces(value))\n}\n\nfunction cast(value: StringOrNumber, step: number, precision?: number) {\n  const decimalPlaces = getDecimalPlaces(parse(value), step)\n  return toPrecision(parse(value), precision ?? decimalPlaces)\n}\n"],"file":"use-counter.js"}