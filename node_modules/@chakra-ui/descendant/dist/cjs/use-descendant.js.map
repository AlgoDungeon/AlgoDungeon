{"version":3,"sources":["../../src/use-descendant.ts"],"names":["useDescendant","props","context","element","indexProp","index","disabled","focusable","rest","forceUpdate","register","unregister","descendants","undefined","Object","values","findIndex","descendant","useDescendants","setDescendants","prevDescendants","find","item","Boolean","compareDocumentPosition","Node","DOCUMENT_POSITION_PRECEDING","newItem","slice","filter"],"mappings":"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","sourcesContent":["import { useCallback, useMemo, useState } from \"react\"\nimport { useSafeLayoutEffect, useForceUpdate } from \"@chakra-ui/hooks\"\n\nexport type Descendant<T extends HTMLElement, P = {}> = P & {\n  element: T | null\n  index?: number\n  disabled?: boolean\n  focusable?: boolean\n}\n\nexport interface DescendantContext<T extends HTMLElement, P = {}> {\n  descendants: Descendant<T, P>[]\n  register: (descendant: Descendant<T, P>) => void\n  unregister: (element: T) => void\n}\n\nexport type UseDescendantProps<T extends HTMLElement, P> = {\n  context: DescendantContext<T, P>\n} & Descendant<T, P>\n\nexport function useDescendant<T extends HTMLElement, P>(\n  props: UseDescendantProps<T, P>,\n) {\n  const {\n    context,\n    element,\n    index: indexProp,\n    disabled,\n    focusable,\n    ...rest\n  } = props\n\n  const forceUpdate = useForceUpdate()\n  const { register, unregister, descendants } = context\n\n  useSafeLayoutEffect(() => {\n    if (!element) {\n      forceUpdate()\n    }\n\n    /**\n     * Don't register this descendant if it is disabled and not focusable\n     */\n    if (disabled && !focusable) return undefined\n\n    /**\n     * else, register the descendant\n     */\n    register({ element, disabled, focusable, ...rest } as any)\n\n    /**\n     * when it unmounts, unregister the descendant\n     */\n    return () => {\n      if (element) {\n        unregister(element)\n      }\n    }\n    // eslint-disable-next-line\n  }, [element, disabled, focusable, ...Object.values(rest)])\n\n  const index =\n    indexProp ??\n    descendants.findIndex((descendant) => descendant.element === element)\n\n  return index\n}\n\nexport function useDescendants<T extends HTMLElement, P>() {\n  const [descendants, setDescendants] = useState<Descendant<T, P>[]>([])\n\n  const register = useCallback(({ element, ...rest }: Descendant<T, P>) => {\n    if (!element) return\n\n    // @ts-ignore\n    setDescendants((prevDescendants) => {\n      if (prevDescendants.find((item) => item.element === element) == null) {\n        const index = prevDescendants.findIndex((item) => {\n          if (!item.element || !element) return false\n\n          return Boolean(\n            item.element.compareDocumentPosition(element) &\n              Node.DOCUMENT_POSITION_PRECEDING,\n          )\n        })\n\n        const newItem = { element, ...rest }\n\n        if (index === -1) {\n          return [...prevDescendants, newItem]\n        }\n        return [\n          ...prevDescendants.slice(0, index),\n          newItem,\n          ...prevDescendants.slice(index),\n        ]\n      }\n      return prevDescendants\n    })\n  }, [])\n\n  const unregister = useCallback((element: T) => {\n    if (!element) return\n    setDescendants((descendants) =>\n      descendants.filter((descendant) => element !== descendant.element),\n    )\n  }, [])\n\n  const context = useMemo(() => ({ descendants, register, unregister }), [\n    descendants,\n    register,\n    unregister,\n  ])\n\n  return context\n}\n"],"file":"use-descendant.js"}