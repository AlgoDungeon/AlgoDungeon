{"version":3,"sources":["../../src/css.ts"],"names":["cache","themeBreakpoints","breakpoints","breakpointValues","mediaQueries","calculateBreakpointAndMediaQueries","isCached","Object","entries","filter","key","reduce","carry","breakpoint","value","push","map","bp","slice","responsive","styles","theme","computedStyles","queries","length","index","media","css","args","props","styleObject","k","x","val","pseudoSelectors","config","parser","property","scale","apply","transform","properties"],"mappings":"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","sourcesContent":["import {\n  Dict,\n  isArray,\n  isCustomBreakpoint,\n  isObject,\n  isResponsiveObjectLike,\n  memoizedGet as get,\n  mergeWith,\n  objectToArrayNotation,\n  runIfFn,\n} from \"@chakra-ui/utils\"\nimport { CSSObject, StyleObjectOrFn } from \"./css.types\"\nimport { parser } from \"./parser\"\nimport { pseudoSelectors } from \"./pseudo\"\n\ninterface Cache {\n  themeBreakpoints: string[]\n  breakpoints: string[]\n  breakpointValues: string[]\n  mediaQueries: (string | null)[]\n}\n\nconst cache: Cache = {\n  themeBreakpoints: [],\n  breakpoints: [],\n  breakpointValues: [],\n  mediaQueries: [],\n}\n\ninterface BreakpointValueObj {\n  /**\n   * left side of a breakpoint object, the name, e.g. sm\n   */\n  breakpoints: string[]\n  /**\n   * right side of a breakpoint object, the size, e.g. 4\n   */\n  breakpointValues: string[]\n}\n\n/**\n *\n */\nconst calculateBreakpointAndMediaQueries = (\n  themeBreakpoints: string[] = [],\n) => {\n  // caching here reduces execution time by factor 4-6x\n  const isCached = cache.themeBreakpoints === themeBreakpoints\n\n  if (isCached) {\n    return cache\n  }\n\n  const { breakpoints, breakpointValues } = Object.entries(themeBreakpoints)\n    .filter(([key]) => isCustomBreakpoint(key))\n    .reduce<BreakpointValueObj>(\n      (carry, [breakpoint, value]) => {\n        carry.breakpoints.push(breakpoint)\n        carry.breakpointValues.push(value)\n\n        return carry\n      },\n      {\n        breakpoints: [],\n        breakpointValues: [],\n      },\n    )\n\n  const mediaQueries = [\n    null,\n    ...breakpointValues\n      .map((bp) => `@media screen and (min-width: ${bp})`)\n      .slice(1),\n  ]\n\n  cache.themeBreakpoints = themeBreakpoints\n  cache.mediaQueries = mediaQueries\n  cache.breakpointValues = breakpointValues\n  cache.breakpoints = breakpoints\n\n  return {\n    breakpoints,\n    mediaQueries,\n  }\n}\n\nconst responsive = (styles: any) => (theme: Dict) => {\n  const computedStyles: any = {}\n\n  const { breakpoints, mediaQueries } = calculateBreakpointAndMediaQueries(\n    theme.breakpoints,\n  )\n\n  for (const key in styles) {\n    let value = runIfFn(styles[key], theme)\n\n    if (value == null) {\n      continue\n    }\n\n    value = isResponsiveObjectLike(value, breakpoints)\n      ? objectToArrayNotation(value, breakpoints)\n      : value\n\n    if (!isArray(value)) {\n      computedStyles[key] = value\n      continue\n    }\n\n    const queries = value.slice(0, mediaQueries.length).length\n\n    for (let index = 0; index < queries; index += 1) {\n      const media = mediaQueries[index]\n\n      if (!media) {\n        computedStyles[key] = value[index]\n        continue\n      }\n\n      computedStyles[media] = computedStyles[media] || {}\n\n      if (value[index] == null) {\n        continue\n      }\n\n      computedStyles[media][key] = value[index]\n    }\n  }\n\n  return computedStyles\n}\n\ntype PropsOrTheme = Dict | { theme: Dict }\n\nexport const css = (args: StyleObjectOrFn = {}) => (\n  props: PropsOrTheme = {},\n) => {\n  const theme = \"theme\" in props ? props.theme : props\n\n  let computedStyles: CSSObject = {}\n\n  const styleObject = runIfFn(args, theme)\n  const styles = responsive(styleObject)(theme)\n\n  for (const k in styles) {\n    const x = styles[k]\n    const val = runIfFn(x, theme)\n\n    const key = k in pseudoSelectors ? pseudoSelectors[k] : k\n    let config = (parser.config as Dict)[key]\n\n    if (config === true) {\n      // shortcut definition\n      config = {\n        property: key,\n        scale: key,\n      }\n    }\n\n    if (key === \"apply\") {\n      const apply = css(get(theme, val))(theme)\n      computedStyles = mergeWith({}, computedStyles, apply)\n      continue\n    }\n\n    if (isObject(val)) {\n      computedStyles[key] = css(val)(theme)\n      continue\n    }\n\n    const scale = get(theme, config?.scale, {})\n    const value = config?.transform?.(val, scale, props) ?? get(scale, val, val)\n\n    if (config?.properties) {\n      for (const property of config.properties) {\n        computedStyles[property] = value\n      }\n      continue\n    }\n\n    if (config?.property) {\n      /**\n       * Used for styled-system configs that map to multiple computed properties.\n       * For example, the `borderLeftRadius` computed keys based on rtl/ltr\n       */\n      if (config.property === \"&\") {\n        computedStyles = mergeWith({}, computedStyles, value)\n      } else {\n        computedStyles[config.property] = value\n      }\n      continue\n    }\n\n    computedStyles[key] = value\n  }\n\n  return computedStyles\n}\n"],"file":"css.js"}